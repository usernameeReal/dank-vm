{var Guacamole=Guacamole||{},Guacamole,Guacamole,Guacamole,Guacamole,Guacamole,Guacamole,Guacamole;Guacamole.ArrayBufferReader=function(e){var a=this;e.onblob=function(e){for(var t=window.atob(e),e=new ArrayBuffer(t.length),n=new Uint8Array(e),o=0;o<t.length;o++)n[o]=t.charCodeAt(o);a.ondata&&a.ondata(e)},e.onend=function(){a.onend&&a.onend()},this.ondata=null,this.onend=null},(Guacamole=Guacamole||{}).ArrayBufferWriter=function(o){var t=this;function a(e){for(var t="",n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);o.sendBlob(window.btoa(t))}o.onack=function(e){t.onack&&t.onack(e)},this.sendData=function(e){var t=new Uint8Array(e);if(t.length<=8064)a(t);else for(var n=0;n<t.length;n+=8064)a(t.subarray(n,n+8094))},this.sendEnd=function(){o.sendEnd()},this.onack=null},(Guacamole=Guacamole||{}).AudioChannel=function(){var o=0;this.play=function(e,t,n){e=new Guacamole.AudioChannel.Packet(e,n),n=Guacamole.AudioChannel.getTimestamp();o<n&&(o=n),e.play(o),o+=t}},window.AudioContext?Guacamole.AudioChannel.context=new AudioContext:window.webkitAudioContext&&(Guacamole.AudioChannel.context=new webkitAudioContext),Guacamole.AudioChannel.getTimestamp=function(){if(Guacamole.AudioChannel.context)return 1e3*Guacamole.AudioChannel.context.currentTime;if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return(new Date).getTime()},Guacamole.AudioChannel.Packet=function(c,e){if(this.play=function(e){},Guacamole.AudioChannel.context){var t,n=null,o=function(e){n=e},a=((i=new FileReader).onload=function(){Guacamole.AudioChannel.context.decodeAudioData(i.result,function(e){o(e)})},i.readAsArrayBuffer(e),Guacamole.AudioChannel.context.createBufferSource());function r(e){a.buffer=e,a.start(t/1e3)}a.connect(Guacamole.AudioChannel.context.destination),a.start||(a.start=a.noteOn),this.play=function(e){t=e,n?r(n):o=r}}else{var i,s=!1,u=null;try{u=new Audio}catch(e){}function l(){u.src?u.play():s=!0}u&&((i=new FileReader).onload=function(){for(var e="",t=new Uint8Array(i.result),n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);u.src="data:"+c+";base64,"+window.btoa(e),s&&u.play()},i.readAsArrayBuffer(e),this.play=function(e){e-=Guacamole.AudioChannel.getTimestamp();e<0?l():window.setTimeout(l,e)})}},(Guacamole=Guacamole||{}).BlobReader=function(a,n){var r=this,i=0,s=new(window.BlobBuilder?BlobBuilder:window.WebKitBlobBuilder?WebKitBlobBuilder:window.MozBlobBuilder?MozBlobBuilder:function(){var t=[];this.append=function(e){t.push(new Blob([e],{type:n}))},this.getBlob=function(){return new Blob(t,{type:n})}});a.onblob=function(e){for(var t=window.atob(e),e=new ArrayBuffer(t.length),n=new Uint8Array(e),o=0;o<t.length;o++)n[o]=t.charCodeAt(o);s.append(e),i+=e.byteLength,r.onprogress&&r.onprogress(e.byteLength),a.sendAck("OK",0)},a.onend=function(){r.onend&&r.onend()},this.getLength=function(){return i},this.getBlob=function(){return s.getBlob()},this.onprogress=null,this.onend=null},(Guacamole=Guacamole||{}).Client=function(s){var u=this,o=2,e=3,t=0,h={0:"butt",1:"round",2:"square"},p={0:"bevel",1:"miter",2:"round"},l=new Guacamole.Display,m={},f=[],g=[],c=[],a=new Guacamole.IntegerPool,r=[];function n(e){e!=t&&(t=e,u.onstatechange&&u.onstatechange(t))}function i(){return t==e||t==o}function d(e){var t=m[e];return t||(t=0===e?l.getDefaultLayer():0<e?l.createLayer():l.createBuffer(),m[e]=t),t}this.getDisplay=function(){return l},this.sendSize=function(e,t){i()&&s.sendMessage("size",e,t)},this.sendKeyEvent=function(e,t){i()&&s.sendMessage("key",t,e)},this.sendMouseState=function(e){var t;i()&&(l.moveCursor(Math.floor(e.x),Math.floor(e.y)),t=0,e.left&&(t|=1),e.middle&&(t|=2),e.right&&(t|=4),e.up&&(t|=8),e.down&&(t|=16),s.sendMessage("mouse",Math.floor(e.x),Math.floor(e.y),t))},this.setClipboard=function(e){if(i()){for(var t=u.createClipboardStream("text/plain"),n=new Guacamole.StringWriter(t),o=0;o<e.length;o+=4096)n.sendText(e.substring(o,o+4096));n.sendEnd()}},this.createFileStream=function(e,t){var n=a.next(),e=(s.sendMessage("file",n,e,t),r[n]=new Guacamole.OutputStream(u,n)),o=e.sendEnd;return e.sendEnd=function(){o(),a.free(n),delete r[n]},e},this.createPipeStream=function(e,t){var n=a.next(),e=(s.sendMessage("pipe",n,e,t),r[n]=new Guacamole.OutputStream(u,n)),o=e.sendEnd;return e.sendEnd=function(){o(),a.free(n),delete r[n]},e},this.createClipboardStream=function(e){var t=a.next(),e=(s.sendMessage("clipboard",t,e),r[t]=new Guacamole.OutputStream(u,t)),n=e.sendEnd;return e.sendEnd=function(){n(),a.free(t),delete r[t]},e},this.sendAck=function(e,t,n){i()&&s.sendMessage("ack",e,t,n)},this.sendBlob=function(e,t){i()&&s.sendMessage("blob",e,t)},this.endStream=function(e){i()&&s.sendMessage("end",e)},this.onstatechange=null,this.onname=null,this.onerror=null,this.onclipboard=null,this.onfile=null,this.onpipe=null,this.onsync=null,this.onturn=null,this.onchat=null,this.onrename=null,this.onadduser=null,this.onremuser=null,this.onconnect=null,this.onlist=null,this.onvote=null,this.onaction=null;var v={"miter-limit":function(e,t){l.setMiterLimit(e,parseFloat(t))}},w={turn:function(e){u.onturn&&u.onturn(e)},rename:function(e){u.onrename&&u.onrename(e)},chat:function(e){u.onchat&&u.onchat(e)},adduser:function(e){u.onadduser&&u.onadduser(e)},remuser:function(e){u.onremuser&&u.onremuser(e)},connect:function(e){u.onconnect&&u.onconnect(e)},list:function(e){u.onlist&&u.onlist(e)},vote:function(e){u.onvote&&u.onvote(e)},action:function(e){u.onaction&&u.onaction(e)},file:function(e){u.onfile&&u.onfile(e)},nop:function(){s.sendMessage("nop")},ack:function(e){var t=parseInt(e[0]),n=e[1],e=parseInt(e[2]),o=r[t];o&&(o.onack&&o.onack(new Guacamole.Status(e,n)),256<=e&&(a.free(t),delete r[t]))},arc:function(e){var t=d(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),a=parseInt(e[3]),r=parseFloat(e[4]),i=parseFloat(e[5]),e=parseInt(e[6]);l.arc(t,n,o,a,r,i,0!=e)},audio:function(e){var t,n=parseInt(e[0]),o=(i=parseInt(e[1]),t=null==(t=g[i])?g[i]=new Guacamole.AudioChannel:t),a=e[2],r=parseFloat(e[3]),i=c[n]=new Guacamole.InputStream(u,n),s=new Guacamole.BlobReader(i,a);s.onend=function(){o.play(a,r,s.getBlob())},u.sendAck(n,"OK",0)},blob:function(e){var t=parseInt(e[0]),e=e[1];c[t].onblob(e)},cfill:function(e){var t=parseInt(e[0]),n=d(parseInt(e[1])),o=parseInt(e[2]),a=parseInt(e[3]),r=parseInt(e[4]),e=parseInt(e[5]);l.setChannelMask(n,t),l.fillColor(n,o,a,r,e)},clip:function(e){e=d(parseInt(e[0]));l.clip(e)},clipboard:function(e){var t,n=parseInt(e[0]),e=e[1];u.onclipboard?(t=c[n]=new Guacamole.InputStream(u,n),u.onclipboard(t,e)):u.sendAck(n,"Clipboard unsupported",256)},close:function(e){e=d(parseInt(e[0]));l.close(e)},copy:function(e){var t=d(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),a=parseInt(e[3]),r=parseInt(e[4]),i=parseInt(e[5]),s=d(parseInt(e[6])),u=parseInt(e[7]),e=parseInt(e[8]);l.setChannelMask(s,i),l.copy(t,n,o,a,r,s,u,e)},cstroke:function(e){var t=parseInt(e[0]),n=d(parseInt(e[1])),o=h[parseInt(e[2])],a=p[parseInt(e[3])],r=parseInt(e[4]),i=parseInt(e[5]),s=parseInt(e[6]),u=parseInt(e[7]),e=parseInt(e[8]);l.setChannelMask(n,t),l.strokeColor(n,o,a,r,i,s,u,e)},cursor:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),o=d(parseInt(e[2])),a=parseInt(e[3]),r=parseInt(e[4]),i=parseInt(e[5]),e=parseInt(e[6]);l.setCursor(t,n,o,a,r,i,e)},curve:function(e){var t=d(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),a=parseInt(e[3]),r=parseInt(e[4]),i=parseInt(e[5]),e=parseInt(e[6]);l.curveTo(t,n,o,a,r,i,e)},dispose:function(e){e=parseInt(e[0]);0<e?(d(e).dispose(),delete m[e]):e<0&&delete m[e]},distort:function(e){var t=parseInt(e[0]),n=parseFloat(e[1]),o=parseFloat(e[2]),a=parseFloat(e[3]),r=parseFloat(e[4]),i=parseFloat(e[5]),e=parseFloat(e[6]);0<=t&&d(t).distort(n,o,a,r,i,e)},error:function(e){var t=e[0],e=parseInt(e[1]);u.onerror&&u.onerror(new Guacamole.Status(e,t)),u.disconnect()},end:function(e){e=parseInt(e[0]),e=c[e];e.onend&&e.onend()},identity:function(e){e=d(parseInt(e[0]));l.setTransform(e,1,0,0,1,0,0)},lfill:function(e){var t=parseInt(e[0]),n=d(parseInt(e[1])),e=d(parseInt(e[2]));l.setChannelMask(n,t),l.fillLayer(n,e)},line:function(e){var t=d(parseInt(e[0])),n=parseInt(e[1]),e=parseInt(e[2]);l.lineTo(t,n,e)},lstroke:function(e){var t=parseInt(e[0]),n=d(parseInt(e[1])),e=d(parseInt(e[2]));l.setChannelMask(n,t),l.strokeLayer(n,e)},move:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),o=parseInt(e[2]),a=parseInt(e[3]),e=parseInt(e[4]);0<t&&0<=n&&(t=d(t),n=d(n),t.move(n,o,a,e))},name:function(e){u.onname&&u.onname(e[0])},nest:function(e){var t,n;t=parseInt(e[0]),null==(n=f[t])&&((n=f[t]=new Guacamole.Parser).oninstruction=s.oninstruction),n.receive(e[1])},pipe:function(e){var t,n=parseInt(e[0]),o=e[1],e=e[2];u.onpipe?(t=c[n]=new Guacamole.InputStream(u,n),u.onpipe(t,o,e)):u.sendAck(n,"Named pipes unsupported",256)},png:function(e){var t=parseInt(e[0]),n=d(parseInt(e[1])),o=parseInt(e[2]),a=parseInt(e[3]),e=e[4];l.setChannelMask(n,t),l.draw(n,o,a,"data:image/png;base64,"+e)},pop:function(e){e=d(parseInt(e[0]));l.pop(e)},push:function(e){e=d(parseInt(e[0]));l.push(e)},rect:function(e){var t=d(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),a=parseInt(e[3]),e=parseInt(e[4]);l.rect(t,n,o,a,e)},reset:function(e){e=d(parseInt(e[0]));l.reset(e)},set:function(e){var t=d(parseInt(e[0])),n=e[1],e=e[2],n=v[n];n&&n(t,e)},shade:function(e){var t=parseInt(e[0]),e=parseInt(e[1]);0<=t&&d(t).shade(e)},size:function(e){var t=d(parseInt(e[0])),n=parseInt(e[1]),e=parseInt(e[2]);l.resize(t,n,e)},start:function(e){var t=d(parseInt(e[0])),n=parseInt(e[1]),e=parseInt(e[2]);l.moveTo(t,n,e)},sync:function(e){e=parseInt(e[0]);l.flush(null),u.onsync&&u.onsync(e)},transfer:function(e){var t=d(parseInt(e[0])),n=parseInt(e[1]),o=parseInt(e[2]),a=parseInt(e[3]),r=parseInt(e[4]),i=parseInt(e[5]),s=d(parseInt(e[6])),u=parseInt(e[7]),e=parseInt(e[8]);3===i?l.put(t,n,o,a,r,s,u,e):5!==i&&l.transfer(t,n,o,a,r,s,u,e,Guacamole.Client.DefaultTransferFunction[i])},transform:function(e){var t=d(parseInt(e[0])),n=parseFloat(e[1]),o=parseFloat(e[2]),a=parseFloat(e[3]),r=parseFloat(e[4]),i=parseFloat(e[5]),e=parseFloat(e[6]);l.transform(t,n,o,a,r,i,e)},video:function(e){var t=parseInt(e[0]),a=d(parseInt(e[1])),r=e[2],i=parseFloat(e[3]),e=c[t]=new Guacamole.InputStream(u,t),n=new Guacamole.BlobReader(e,r);n.onend=function(){var o=new FileReader;o.onload=function(){for(var e="",t=new Uint8Array(o.result),n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);a.play(r,i,"data:"+r+";base64,"+window.btoa(e))},o.readAsArrayBuffer(n.getBlob())},s.sendMessage("ack",t,"OK",0)}};s.oninstruction=function(e,t){e=w[e];e&&e(t)},this.disconnect=function(){5!=t&&4!=t&&(n(4),s.sendMessage("disconnect"),s.disconnect(),n(5))},this.connect=function(e){n(1);try{s.connect(e)}catch(e){throw n(0),e}n(o)}},Guacamole.Client.DefaultTransferFunction={0:function(e,t){t.red=t.green=t.blue=0},15:function(e,t){t.red=t.green=t.blue=255},3:function(e,t){t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha},5:function(e,t){},12:function(e,t){t.red=255&~e.red,t.green=255&~e.green,t.blue=255&~e.blue,t.alpha=e.alpha},10:function(e,t){t.red=255&~t.red,t.green=255&~t.green,t.blue=255&~t.blue},1:function(e,t){t.red=e.red&t.red,t.green=e.green&t.green,t.blue=e.blue&t.blue},14:function(e,t){t.red=255&~(e.red&t.red),t.green=255&~(e.green&t.green),t.blue=255&~(e.blue&t.blue)},7:function(e,t){t.red=e.red|t.red,t.green=e.green|t.green,t.blue=e.blue|t.blue},8:function(e,t){t.red=255&~(e.red|t.red),t.green=255&~(e.green|t.green),t.blue=255&~(e.blue|t.blue)},6:function(e,t){t.red=e.red^t.red,t.green=e.green^t.green,t.blue=e.blue^t.blue},9:function(e,t){t.red=255&~(e.red^t.red),t.green=255&~(e.green^t.green),t.blue=255&~(e.blue^t.blue)},4:function(e,t){t.red=~e.red&t.red&255,t.green=~e.green&t.green&255,t.blue=~e.blue&t.blue&255},13:function(e,t){t.red=255&(~e.red|t.red),t.green=255&(~e.green|t.green),t.blue=255&(~e.blue|t.blue)},2:function(e,t){t.red=e.red&~t.red&255,t.green=e.green&~t.green&255,t.blue=e.blue&~t.blue&255},11:function(e,t){t.red=255&(e.red|~t.red),t.green=255&(e.green|~t.green),t.blue=255&(e.blue|~t.blue)}},(Guacamole=Guacamole||{}).Display=function(){var s=this,o=0,a=0,r=1,i=document.createElement("div"),l=(i.style.position="relative",i.style.width=o+"px",i.style.height=a+"px",i.style.transformOrigin=i.style.webkitTransformOrigin=i.style.MozTransformOrigin=i.style.OTransformOrigin=i.style.msTransformOrigin="0 0",new Guacamole.Display.VisibleLayer(o,a)),u=new Guacamole.Display.VisibleLayer(0,0),c=(u.setChannelMask(Guacamole.Layer.SRC),i.appendChild(l.getElement()),i.appendChild(u.getElement()),document.createElement("div")),h=(c.style.position="relative",c.style.width=o*r+"px",c.style.height=a*r+"px",c.appendChild(i),this.cursorHotspotX=0,this.cursorHotspotY=0,this.cursorX=0,this.cursorY=0,this.onresize=null,this.oncursor=null,[]),n=[];function p(){for(var e=0;e<n.length;){var t=n[e];if(!t.isReady())break;t.flush(),e++}n.splice(0,e)}function t(t,n){this.isReady=function(){for(var e=0;e<n.length;e++)if(n[e].blocked)return!1;return!0},this.flush=function(){for(var e=0;e<n.length;e++)n[e].execute();t&&t()}}function m(e,t){var n=this;this.blocked=t,this.unblock=function(){n.blocked&&(n.blocked=!1,p())},this.execute=function(){e&&e()}}function d(e,t){e=new m(e,t);return h.push(e),e}this.getElement=function(){return c},this.getWidth=function(){return o},this.getHeight=function(){return a},this.getDefaultLayer=function(){return l},this.getCursorLayer=function(){return u},this.createLayer=function(){var e=new Guacamole.Display.VisibleLayer(o,a);return e.move(l,0,0,0),e},this.createBuffer=function(){var e=new Guacamole.Layer(0,0);return e.autosize=1,e},this.flush=function(e){n.push(new t(e,h)),h=[],p()},this.setCursor=function(e,t,n,o,a,r,i){d(function(){s.cursorHotspotX=e,s.cursorHotspotY=t,u.resize(r,i),u.copy(n,o,a,r,i,0,0),s.moveCursor(s.cursorX,s.cursorY),s.oncursor&&s.oncursor(u.getCanvas(),e,t)})},this.showCursor=function(e){var t=u.getElement(),n=t.parentNode;!1===e?n&&n.removeChild(t):n!==i&&i.appendChild(t)},this.moveCursor=function(e,t){u.translate(e-s.cursorHotspotX,t-s.cursorHotspotY),s.cursorX=e,s.cursorY=t},this.resize=function(e,t,n){d(function(){e.resize(t,n),e===l&&(o=t,a=n,i.style.width=o+"px",i.style.height=a+"px",c.style.width=o*r+"px",c.style.height=a*r+"px",s.onresize&&s.onresize(t,n))})},this.drawImage=function(e,t,n,o){d(function(){e.drawImage(t,n,o)})},this.draw=function(e,t,n,o){var a=d(function(){e.drawImage(t,n,r)},!0),r=new Image;r.onload=a.unblock,r.src=o},this.play=function(t,e,n,o){var a=document.createElement("video");a.type=e,a.src=o,a.addEventListener("play",function(){!function e(){t.drawImage(0,0,a),a.ended||window.setTimeout(e,20)}()},!1),d(a.play)},this.transfer=function(e,t,n,o,a,r,i,s,u){d(function(){r.transfer(e,t,n,o,a,i,s,u)})},this.put=function(e,t,n,o,a,r,i,s){d(function(){r.put(e,t,n,o,a,i,s)})},this.copy=function(e,t,n,o,a,r,i,s){d(function(){r.copy(e,t,n,o,a,i,s)})},this.moveTo=function(e,t,n){d(function(){e.moveTo(t,n)})},this.lineTo=function(e,t,n){d(function(){e.lineTo(t,n)})},this.arc=function(e,t,n,o,a,r,i){d(function(){e.arc(t,n,o,a,r,i)})},this.curveTo=function(e,t,n,o,a,r,i){d(function(){e.curveTo(t,n,o,a,r,i)})},this.close=function(e){d(function(){e.close()})},this.rect=function(e,t,n,o,a){d(function(){e.rect(t,n,o,a)})},this.clip=function(e){d(function(){e.clip()})},this.strokeColor=function(e,t,n,o,a,r,i,s){d(function(){e.strokeColor(t,n,o,a,r,i,s)})},this.fillColor=function(e,t,n,o,a){d(function(){e.fillColor(t,n,o,a)})},this.strokeLayer=function(e,t,n,o,a){d(function(){e.strokeLayer(t,n,o,a)})},this.fillLayer=function(e,t){d(function(){e.fillLayer(t)})},this.push=function(e){d(function(){e.push()})},this.pop=function(e){d(function(){e.pop()})},this.reset=function(e){d(function(){e.reset()})},this.setTransform=function(e,t,n,o,a,r,i){d(function(){e.setTransform(t,n,o,a,r,i)})},this.transform=function(e,t,n,o,a,r,i){d(function(){e.transform(t,n,o,a,r,i)})},this.setChannelMask=function(e,t){d(function(){e.setChannelMask(t)})},this.setMiterLimit=function(e,t){d(function(){e.setMiterLimit(t)})},this.scale=function(e){i.style.transform=i.style.WebkitTransform=i.style.MozTransform=i.style.OTransform=i.style.msTransform="scale("+e+","+e+")",r=e,c.style.width=o*r+"px",c.style.height=a*r+"px"},this.getScale=function(){return r},this.flatten=function(){var e=document.createElement("canvas"),u=(e.width=l.width,e.height=l.height,e.getContext("2d"));return function e(t,n,o){if(0<t.width&&0<t.height){for(var a=u.globalAlpha,r=(u.globalAlpha*=t.alpha/255,u.drawImage(t.getCanvas(),n,o),function(e){var t,n=[];for(t in e.children)n.push(e.children[t]);return n.sort(function(e,t){var n=e.z-t.z;return 0!=n?n:(n=e.getElement(),(e=t.getElement().compareDocumentPosition(n))&Node.DOCUMENT_POSITION_PRECEDING?-1:e&Node.DOCUMENT_POSITION_FOLLOWING?1:0)}),n}(t)),i=0;i<r.length;i++){var s=r[i];e(s,n+s.x,o+s.y)}u.globalAlpha=a}}(l,0,0),e}},Guacamole.Display.VisibleLayer=function(e,t){Guacamole.Layer.apply(this,[e,t]);var i=this,n=(this.__unique_id=Guacamole.Display.VisibleLayer.__next_id++,this.alpha=255,this.x=0,this.y=0,this.z=0,this.matrix=[1,0,0,1,0,0],this.parent=null,this.children={},i.getCanvas()),s=(n.style.position="absolute",n.style.left="0px",n.style.top="0px",document.createElement("div")),o=(s.appendChild(n),s.style.width=e+"px",s.style.height=t+"px",s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style.overflow="hidden",this.resize),u=(this.resize=function(e,t){s.style.width=e+"px",s.style.height=t+"px",o(e,t)},this.getElement=function(){return s},"translate(0px, 0px)"),l="matrix(1, 0, 0, 1, 0, 0)";this.translate=function(e,t){i.x=e,i.y=t,u="translate("+e+"px,"+t+"px)",s.style.transform=s.style.WebkitTransform=s.style.MozTransform=s.style.OTransform=s.style.msTransform=u+" "+l},this.move=function(e,t,n,o){i.parent!==e&&(i.parent&&delete i.parent.children[i.__unique_id],(i.parent=e).children[i.__unique_id]=i,e.getElement().appendChild(s)),i.translate(t,n),i.z=o,s.style.zIndex=o},this.shade=function(e){i.alpha=e,s.style.opacity=e/255},this.dispose=function(){i.parent&&(delete i.parent.children[i.__unique_id],i.parent=null),s.parentNode&&s.parentNode.removeChild(s)},this.distort=function(e,t,n,o,a,r){i.matrix=[e,t,n,o,a,r],l="matrix("+e+","+t+","+n+","+o+","+a+","+r+")",s.style.transform=s.style.WebkitTransform=s.style.MozTransform=s.style.OTransform=s.style.msTransform=u+" "+l}},Guacamole.Display.VisibleLayer.__next_id=0,(Guacamole=Guacamole||{}).InputStream=function(n,e){var o=this;this.index=e,this.onblob=null,this.onend=null,this.sendAck=function(e,t){n.sendAck(o.index,e,t)}},(Guacamole=Guacamole||{}).IntegerPool=function(){var e=this,t=[];this.next_int=0,this.next=function(){return 0<t.length?t.shift():e.next_int++},this.free=function(e){t.push(e)}}}(Guacamole=Guacamole||{}).Keyboard=function(e){function a(){var e=this;this.timestamp=(new Date).getTime(),this.defaultPrevented=!1,this.keysym=null,this.reliable=!1,this.getAge=function(){return(new Date).getTime()-e.timestamp}}var i=this,s=(this.onkeydown=null,this.onkeyup=null,function(e,t,n,o){a.apply(this),this.keyCode=e,this.keyIdentifier=t,this.key=n,this.location=o,this.keysym=g(n,o)||w(e,o),this.keysym&&(this.reliable=!0),!this.keysym&&function(e,t){if(!t)return!1;var n=t.indexOf("U+");if(-1===n)return!0;t=parseInt(t.substring(n+2),16);return e!==t||(65<=e&&e<=90||48<=e&&e<=57)}(e,t)&&(this.keysym=g(t,o,i.modifiers.shift));n=!(i.modifiers.ctrl||navigator&&navigator.platform&&navigator.platform.match(/^mac/i));(!i.modifiers.alt&&i.modifiers.ctrl||n&&i.modifiers.alt||i.modifiers.meta||i.modifiers.hyper)&&(this.reliable=!0),d[e]=this.keysym}),u=(s.prototype=new a,function(e){a.apply(this),this.charCode=e,this.keysym=v(e),this.reliable=!0}),l=(u.prototype=new a,function(e,t,n,o){a.apply(this),this.keyCode=e,this.keyIdentifier=t,this.key=n,this.location=o,this.keysym=d[e]||w(e,o)||g(n,o),this.reliable=!0}),c=(l.prototype=new a,[]),r={8:[65288],9:[65289],13:[65293],16:[65505,65505,65506],17:[65507,65507,65508],18:[65513,65513,65027],19:[65299],20:[65509],27:[65307],32:[32],33:[65365],34:[65366],35:[65367],36:[65360],37:[65361],38:[65362],39:[65363],40:[65364],45:[65379],46:[65535],91:[65515],92:[65383],93:null,112:[65470],113:[65471],114:[65472],115:[65473],116:[65474],117:[65475],118:[65476],119:[65477],120:[65478],121:[65479],122:[65480],123:[65481],144:[65407],145:[65300],225:[65027]},h={Again:[65382],AllCandidates:[65341],Alphanumeric:[65328],Alt:[65513,65513,65027],Attn:[64782],AltGraph:[65027],ArrowDown:[65364],ArrowLeft:[65361],ArrowRight:[65363],ArrowUp:[65362],Backspace:[65288],CapsLock:[65509],Cancel:[65385],Clear:[65291],Convert:[65313],Copy:[64789],Crsel:[64796],CrSel:[64796],CodeInput:[65335],Compose:[65312],Control:[65507,65507,65508],ContextMenu:[65383],DeadGrave:[65104],DeadAcute:[65105],DeadCircumflex:[65106],DeadTilde:[65107],DeadMacron:[65108],DeadBreve:[65109],DeadAboveDot:[65110],DeadUmlaut:[65111],DeadAboveRing:[65112],DeadDoubleacute:[65113],DeadCaron:[65114],DeadCedilla:[65115],DeadOgonek:[65116],DeadIota:[65117],DeadVoicedSound:[65118],DeadSemivoicedSound:[65119],Delete:[65535],Down:[65364],End:[65367],Enter:[65293],EraseEof:[64774],Escape:[65307],Execute:[65378],Exsel:[64797],ExSel:[64797],F1:[65470],F2:[65471],F3:[65472],F4:[65473],F5:[65474],F6:[65475],F7:[65476],F8:[65477],F9:[65478],F10:[65479],F11:[65480],F12:[65481],F13:[65482],F14:[65483],F15:[65484],F16:[65485],F17:[65486],F18:[65487],F19:[65488],F20:[65489],F21:[65490],F22:[65491],F23:[65492],F24:[65493],Find:[65384],GroupFirst:[65036],GroupLast:[65038],GroupNext:[65032],GroupPrevious:[65034],FullWidth:null,HalfWidth:null,HangulMode:[65329],Hankaku:[65321],HanjaMode:[65332],Help:[65386],Hiragana:[65317],HiraganaKatakana:[65319],Home:[65360],Hyper:[65517,65517,65518],Insert:[65379],JapaneseHiragana:[65317],JapaneseKatakana:[65318],JapaneseRomaji:[65316],JunjaMode:[65336],KanaMode:[65325],KanjiMode:[65313],Katakana:[65318],Left:[65361],Meta:[65511,65511,65512],ModeChange:[65406],NumLock:[65407],PageDown:[65366],PageUp:[65365],Pause:[65299],Play:[64790],PreviousCandidate:[65342],PrintScreen:[64797],Redo:[65382],Right:[65363],RomanCharacters:null,Scroll:[65300],Select:[65376],Separator:[65452],Shift:[65505,65505,65506],SingleCandidate:[65340],Super:[65515,65515,65516],Tab:[65289],Up:[65362],Undo:[65381],Win:[65515],Zenkaku:[65320],ZenkakuHankaku:[65322]},p={65027:!0,65505:!0,65506:!0,65507:!0,65508:!0,65511:!0,65512:!0,65513:!0,65514:!0,65515:!0,65516:!0},m=(this.modifiers=new Guacamole.Keyboard.ModifierState,this.pressed={},{}),d={},n=null,o=null;function f(e,t){return e?e[t]||e[0]:null}function g(e,t,n){if(!e)return null;var o=e.indexOf("U+");if(0<=o)var o=e.substring(o+2),a=String.fromCharCode(parseInt(o,16));else{if(1!==e.length)return f(h[e],t);a=e}return!0===n?a=a.toUpperCase():!1===n&&(a=a.toLowerCase()),v(a.charCodeAt(0))}function v(e){return(t=e)<=31||127<=t&&t<=159?65280|e:0<=e&&e<=255?e:256<=e&&e<=1114111?16777216|e:null;var t}function w(e,t){return f(r[e],t)}function y(e){e=Guacamole.Keyboard.ModifierState.fromKeyboardEvent(e);i.modifiers.alt&&!1===e.alt&&(i.release(65513),i.release(65514),i.release(65027)),i.modifiers.shift&&!1===e.shift&&(i.release(65505),i.release(65506)),i.modifiers.ctrl&&!1===e.ctrl&&(i.release(65507),i.release(65508)),i.modifiers.meta&&!1===e.meta&&(i.release(65511),i.release(65512)),i.modifiers.hyper&&!1===e.hyper&&(i.release(65515),i.release(65516)),i.modifiers=e}function b(){var e,t=S();if(t){for(;e=t,null!==(t=S()););return e.defaultPrevented}}function S(){var e=c[0];if(!e)return null;if(!(e instanceof s))return e instanceof l&&((n=e.keysym)?(i.release(n),e.defaultPrevented=!0):i.reset()),c.shift();var t,n=null,o=[];if(e.reliable?(n=e.keysym,o=c.splice(0,1)):c[1]instanceof u?(n=c[1].keysym,o=c.splice(0,2)):c[1]&&(n=e.keysym,o=c.splice(0,1)),0<o.length){if(n){t=n,i.modifiers.ctrl&&i.modifiers.alt&&(65<=t&&t<=90||97<=t&&t<=122||(t<=255||16777216==(4278190080&t))&&(i.release(65507),i.release(65508),i.release(65513),i.release(65514)));var a=!i.press(n);d[e.keyCode]=n,i.modifiers.meta&&65511!==n&&65512!==n&&i.release(n);for(var r=0;r<o.length;r++)o[r].defaultPrevented=a}return e}return null}this.press=function(e){if(null!==e){var t;if(!i.pressed[e])if(i.pressed[e]=!0,i.onkeydown)return t=i.onkeydown(e),m[e]=t,window.clearTimeout(n),window.clearInterval(o),p[e]||(n=window.setTimeout(function(){o=window.setInterval(function(){i.onkeyup(e),i.onkeydown(e)},50)},500)),t;return m[e]||!1}},this.release=function(e){i.pressed[e]&&(delete i.pressed[e],window.clearTimeout(n),window.clearInterval(o),null!==e&&i.onkeyup&&i.onkeyup(e))},this.reset=function(){for(var e in i.pressed)i.release(parseInt(e));c=[]};function k(e){return"location"in e?e.location:"keyLocation"in e?e.keyLocation:0}e.addEventListener("keydown",function(e){var t;i.onkeydown&&(window.event?t=window.event.keyCode:e.which&&(t=e.which),y(e),229!==t&&(t=new s(t,e.keyIdentifier,e.key,k(e)),c.push(t),b()&&e.preventDefault()))},!0),e.addEventListener("keypress",function(e){var t;(i.onkeydown||i.onkeyup)&&(window.event?t=window.event.keyCode:e.which&&(t=e.which),y(e),t=new u(t),c.push(t),b()&&e.preventDefault())},!0),e.addEventListener("keyup",function(e){var t;i.onkeyup&&(e.preventDefault(),window.event?t=window.event.keyCode:e.which&&(t=e.which),y(e),t=new l(t,e.keyIdentifier,e.key,k(e)),c.push(t),b())},!0)},Guacamole.Keyboard.ModifierState=function(){this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.hyper=!1},Guacamole.Keyboard.ModifierState.fromKeyboardEvent=function(e){var t=new Guacamole.Keyboard.ModifierState;return t.shift=e.shiftKey,t.ctrl=e.ctrlKey,t.alt=e.altKey,t.meta=e.metaKey,e.getModifierState&&(t.hyper=e.getModifierState("OS")||e.getModifierState("Super")||e.getModifierState("Hyper")||e.getModifierState("Win")),t},(Guacamole=Guacamole||{}).Layer=function(e,t){var m=this,a=document.createElement("canvas"),f=a.getContext("2d"),s=(f.save(),!0),r=0,n={1:"destination-in",2:"destination-out",4:"source-in",6:"source-atop",8:"source-out",9:"destination-atop",10:"xor",11:"destination-over",12:"copy",14:"source-over",15:"lighter"};function g(e,t,n,o){n+=e,e=o+t,o=n>m.width?n:m.width,t=e>m.height?e:m.height;m.resize(o,t)}this.autosize=!1,this.width=e,this.height=t,this.getCanvas=function(){return a},this.resize=function(e,t){var n,o;e===m.width&&t===m.height||(e=e,t=t,n=null,0!==m.width&&0!==m.height&&((n=document.createElement("canvas")).width=m.width,n.height=m.height,n.getContext("2d").drawImage(a,0,0,m.width,m.height,0,0,m.width,m.height)),o=f.globalCompositeOperation,a.width=e,a.height=t,n&&f.drawImage(n,0,0,m.width,m.height,0,0,m.width,m.height),f.globalCompositeOperation=o,m.width=e,m.height=t,r=0,f.save())},this.drawImage=function(e,t,n){m.autosize&&g(e,t,n.width,n.height),f.drawImage(n,e,t)},this.transfer=function(c,e,t,n,o,a,d,h){var r=c.getCanvas();if(!(e>=r.width||t>=r.height)&&(e+n>r.width&&(n=r.width-e),t+o>r.height&&(o=r.height-t),0!==n&&0!==o)){m.autosize&&g(a,d,n,o);for(var i=c.getCanvas().getContext("2d").getImageData(e,t,n,o),s=f.getImageData(a,d,n,o),u=0;u<n*o*4;u+=4){var p=new Guacamole.Layer.Pixel(i.data[u],i.data[u+1],i.data[u+2],i.data[u+3]),l=new Guacamole.Layer.Pixel(s.data[u],s.data[u+1],s.data[u+2],s.data[u+3]);h(p,l),s.data[u]=l.red,s.data[u+1]=l.green,s.data[u+2]=l.blue,s.data[u+3]=l.alpha}f.putImageData(s,a,d)}},this.put=function(e,t,n,o,a,r,i){var s=e.getCanvas();t>=s.width||n>=s.height||(t+o>s.width&&(o=s.width-t),n+a>s.height&&(a=s.height-n),0!==o&&0!==a&&(m.autosize&&g(r,i,o,a),s=e.getCanvas().getContext("2d").getImageData(t,n,o,a),f.putImageData(s,r,i)))},this.copy=function(e,t,n,o,a,r,i){e=e.getCanvas();t>=e.width||n>=e.height||(t+o>e.width&&(o=e.width-t),n+a>e.height&&(a=e.height-n),0!==o&&0!==a&&(m.autosize&&g(r,i,o,a),f.drawImage(e,t,n,o,a,r,i,o,a)))},this.moveTo=function(e,t){s&&(f.beginPath(),s=!1),m.autosize&&g(e,t,0,0),f.moveTo(e,t)},this.lineTo=function(e,t){s&&(f.beginPath(),s=!1),m.autosize&&g(e,t,0,0),f.lineTo(e,t)},this.arc=function(e,t,n,o,a,r){s&&(f.beginPath(),s=!1),m.autosize&&g(e,t,0,0),f.arc(e,t,n,o,a,r)},this.curveTo=function(e,t,n,o,a,r){s&&(f.beginPath(),s=!1),m.autosize&&g(a,r,0,0),f.bezierCurveTo(e,t,n,o,a,r)},this.close=function(){f.closePath(),s=!0},this.rect=function(e,t,n,o){s&&(f.beginPath(),s=!1),m.autosize&&g(e,t,n,o),f.rect(e,t,n,o)},this.clip=function(){f.clip(),s=!0},this.strokeColor=function(e,t,n,o,a,r,i){f.lineCap=e,f.lineJoin=t,f.lineWidth=n,f.strokeStyle="rgba("+o+","+a+","+r+","+i/255+")",f.stroke(),s=!0},this.fillColor=function(e,t,n,o){f.fillStyle="rgba("+e+","+t+","+n+","+o/255+")",f.fill(),s=!0},this.strokeLayer=function(e,t,n,o){f.lineCap=e,f.lineJoin=t,f.lineWidth=n,f.strokeStyle=f.createPattern(o.getCanvas(),"repeat"),f.stroke(),s=!0},this.fillLayer=function(e){f.fillStyle=f.createPattern(e.getCanvas(),"repeat"),f.fill(),s=!0},this.push=function(){f.save(),r++},this.pop=function(){0<r&&(f.restore(),r--)},this.reset=function(){for(;0<r;)f.restore(),r--;f.restore(),f.save(),f.beginPath(),s=!1},this.setTransform=function(e,t,n,o,a,r){f.setTransform(e,t,n,o,a,r)},this.transform=function(e,t,n,o,a,r){f.transform(e,t,n,o,a,r)},this.setChannelMask=function(e){f.globalCompositeOperation=n[e]},this.setMiterLimit=function(e){f.miterLimit=e},a.width=e,a.height=t,a.style.zIndex=-1},Guacamole.Layer.ROUT=2,Guacamole.Layer.ATOP=6,Guacamole.Layer.XOR=10,Guacamole.Layer.ROVER=11,Guacamole.Layer.OVER=14,Guacamole.Layer.PLUS=15,Guacamole.Layer.RIN=1,Guacamole.Layer.IN=4,Guacamole.Layer.OUT=8,Guacamole.Layer.RATOP=9,Guacamole.Layer.SRC=12,Guacamole.Layer.Pixel=function(e,t,n,o){this.red=e,this.green=t,this.blue=n,this.alpha=o},(Guacamole=Guacamole||{}).Mouse=function(o){var n=this,t=(this.touchMouseThreshold=3,this.scrollThreshold=120,this.PIXELS_PER_LINE=40,this.PIXELS_PER_PAGE=640,this.currentState=new Guacamole.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,this.onmouseout=null,0),a=0;function r(e){e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function e(){t=n.touchMouseThreshold}function i(e){var t=e.deltaY||-e.wheelDeltaY||-e.wheelDelta;for(t?1===e.deltaMode?t=e.deltaY*n.PIXELS_PER_LINE:2===e.deltaMode&&(t=e.deltaY*n.PIXELS_PER_PAGE):t=e.detail*n.PIXELS_PER_LINE,a+=t;a<=-n.scrollThreshold;)n.onmousedown&&(n.currentState.up=!0,n.onmousedown(n.currentState)),n.onmouseup&&(n.currentState.up=!1,n.onmouseup(n.currentState)),a+=n.scrollThreshold;for(;a>=n.scrollThreshold;)n.onmousedown&&(n.currentState.down=!0,n.onmousedown(n.currentState)),n.onmouseup&&(n.currentState.down=!1,n.onmouseup(n.currentState)),a-=n.scrollThreshold;r(e)}o.addEventListener("contextmenu",function(e){r(e)},!1),o.addEventListener("mousemove",function(e){r(e),t?t--:(n.currentState.fromClientPosition(o,e.clientX,e.clientY),n.onmousemove&&n.onmousemove(n.currentState))},!1),o.addEventListener("mousedown",function(e){if(r(e),!t){switch(e.button){case 0:n.currentState.left=!0;break;case 1:n.currentState.middle=!0;break;case 2:n.currentState.right=!0}n.onmousedown&&n.onmousedown(n.currentState)}},!1),o.addEventListener("mouseup",function(e){if(r(e),!t){switch(e.button){case 0:n.currentState.left=!1;break;case 1:n.currentState.middle=!1;break;case 2:n.currentState.right=!1}n.onmouseup&&n.onmouseup(n.currentState)}},!1),o.addEventListener("mouseout",function(e){for(var t=(e=e||window.event).relatedTarget||e.toElement;t;){if(t===o)return;t=t.parentNode}r(e),(n.currentState.left||n.currentState.middle||n.currentState.right)&&(n.currentState.left=!1,n.currentState.middle=!1,n.currentState.right=!1,n.onmouseup&&n.onmouseup(n.currentState)),n.onmouseout&&n.onmouseout()},!1),o.addEventListener("selectstart",function(e){r(e)},!1),o.addEventListener("touchmove",e,!1),o.addEventListener("touchstart",e,!1),o.addEventListener("touchend",e,!1),o.addEventListener("DOMMouseScroll",i,!1),o.addEventListener("mousewheel",i,!1),o.addEventListener("wheel",i,!1);var s=function(){var e=document.createElement("div");if(!("cursor"in e.style))return!1;try{e.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX///+nxBvIAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==) 0 0, auto"}catch(e){return!1}return/\burl\([^()]*\)\s+0\s+0\b/.test(e.style.cursor||"")}();this.setCursor=function(e,t,n){return!!s&&(e=e.toDataURL("image/png"),o.style.cursor="url("+e+") "+t+" "+n+", auto",!0)}},Guacamole.Mouse.State=function(e,t,n,o,a,r,i){var s=this;this.x=e,this.y=t,this.left=n,this.middle=o,this.right=a,this.up=r,this.down=i,this.fromClientPosition=function(e,t,n){s.x=t-e.offsetLeft,s.y=n-e.offsetTop;for(var o=e.offsetParent;o&&o!==document.body;)s.x-=o.offsetLeft-o.scrollLeft,s.y-=o.offsetTop-o.scrollTop,o=o.offsetParent;o&&(t=document.body.scrollLeft||document.documentElement.scrollLeft,n=document.body.scrollTop||document.documentElement.scrollTop,s.x-=o.offsetLeft-t,s.y-=o.offsetTop-n)}},Guacamole.Mouse.Touchpad=function(a){var r=this,i=(this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=10*(window.devicePixelRatio||1),this.currentState=new Guacamole.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,0),s=0,u=0,l=0,c=0,n={1:"left",2:"right",3:"middle"},o=!1,d=null;a.addEventListener("touchend",function(e){var t;e.preventDefault(),o&&0===e.touches.length&&(e=(new Date).getTime(),t=n[i],r.currentState[t]&&(r.currentState[t]=!1,r.onmouseup&&r.onmouseup(r.currentState),d&&(window.clearTimeout(d),d=null)),e-l<=r.clickTimingThreshold&&c<r.clickMoveThreshold&&(r.currentState[t]=!0,r.onmousedown&&r.onmousedown(r.currentState),d=window.setTimeout(function(){r.currentState[t]=!1,r.onmouseup&&r.onmouseup(r.currentState),o=!1},r.clickTimingThreshold)),d||(o=!1))},!1),a.addEventListener("touchstart",function(e){e.preventDefault(),i=Math.min(e.touches.length,3),d&&(window.clearTimeout(d),d=null),o||(o=!0,e=e.touches[0],s=e.clientX,u=e.clientY,l=(new Date).getTime(),c=0)},!1),a.addEventListener("touchmove",function(e){e.preventDefault();var t,e=e.touches[0],n=e.clientX-s,o=e.clientY-u;c+=Math.abs(n)+Math.abs(o),1===i?(t=1+c/((new Date).getTime()-l),r.currentState.x+=n*t,r.currentState.y+=o*t,r.currentState.x<0?r.currentState.x=0:r.currentState.x>=a.offsetWidth&&(r.currentState.x=a.offsetWidth-1),r.currentState.y<0?r.currentState.y=0:r.currentState.y>=a.offsetHeight&&(r.currentState.y=a.offsetHeight-1),r.onmousemove&&r.onmousemove(r.currentState),s=e.clientX,u=e.clientY):2===i&&Math.abs(o)>=r.scrollThreshold&&(r.currentState[n=0<o?"down":"up"]=!0,r.onmousedown&&r.onmousedown(r.currentState),r.currentState[n]=!1,r.onmouseup&&r.onmouseup(r.currentState),s=e.clientX,u=e.clientY)},!1)},Guacamole.Mouse.Touchscreen=function(n){var o=this,a=!1,r=null,i=null,s=null,u=null;function h(e){o.currentState[e]||(o.currentState[e]=!0,o.onmousedown&&o.onmousedown(o.currentState))}function l(e){o.currentState[e]&&(o.currentState[e]=!1,o.onmouseup&&o.onmouseup(o.currentState))}function c(e,t){o.currentState.fromClientPosition(n,e,t),o.onmousemove&&o.onmousemove(o.currentState)}function t(e){var e=e.touches[0]||e.changedTouches[0],t=e.clientX-r,e=e.clientY-i;return Math.sqrt(t*t+e*e)>=o.clickMoveThreshold}function d(){window.clearTimeout(s),window.clearTimeout(u),a=!1}this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=16*(window.devicePixelRatio||1),this.longPressThreshold=500,this.currentState=new Guacamole.Mouse.State(0,0,!1,!1,!1,!1,!1),this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,n.addEventListener("touchend",function(e){a&&(0===e.touches.length&&1===e.changedTouches.length?(window.clearTimeout(u),l("left"),t(e)||(e.preventDefault(),o.currentState.left||(c((e=e.changedTouches[0]).clientX,e.clientY),h("left"),s=window.setTimeout(function(){l("left"),d()},o.clickTimingThreshold)))):d())},!1),n.addEventListener("touchstart",function(t){var e;1===t.touches.length?(t.preventDefault(),e=(e=t).touches[0],a=!0,r=e.clientX,i=e.clientY,window.clearTimeout(s),u=window.setTimeout(function(){var e=t.touches[0];c(e.clientX,e.clientY),h(e="right"),l(e),d()},o.longPressThreshold)):d()},!1),n.addEventListener("touchmove",function(e){a&&(t(e)&&window.clearTimeout(u),1===e.touches.length?o.currentState.left&&(e.preventDefault(),c((e=e.touches[0]).clientX,e.clientY)):d())},!1)},(Guacamole=Guacamole||{}).OnScreenKeyboard=function(o){var f=this,a={},r={},g=[],v=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},i=function(e,n){e.classList?e.classList.remove(n):e.className=e.className.replace(/([^ ]+)[ ]*/g,function(e,t){return t===n?"":e})},w=0,b=function(t,n,o,a){this.width=n,this.height=o,this.scale=function(e){t.style.width=n*e+"px",t.style.height=o*e+"px",a&&(t.style.lineHeight=o*e+"px",t.style.fontSize=e+"px")}},u=function(e){for(var t=0;t<e.length;t++)if(!(e[t]in a))return!1;return!0},l=function(e){var t=f.keys[e];if(!t)return null;for(var n=t.length-1;0<=n;n--){var o=t[n];if(u(o.requires))return o}return null},S=function(e,t){var n,o;f.disabled||r[e]||(v(t,"guac-keyboard-pressed"),(t=l(e)).modifier?(n="guac-keyboard-modifier-"+y(t.modifier),(o=a[t.modifier])?(i(s,n),delete a[t.modifier],f.onkeyup&&f.onkeyup(o)):(v(s,n),a[t.modifier]=t.keysym,f.onkeydown&&f.onkeydown(t.keysym))):f.onkeydown&&f.onkeydown(t.keysym),r[e]=!0)},k=function(e,t){f.disabled||r[e]&&(i(t,"guac-keyboard-pressed"),!(t=l(e)).modifier&&f.onkeyup&&f.onkeyup(t.keysym),r[e]=!1)},s=document.createElement("div"),c=(s.className="guac-keyboard",s.onselectstart=s.onmousemove=s.onmouseup=s.onmousedown=function(e){return w&&w--,e.stopPropagation(),!1},this.touchMouseThreshold=3,this.onkeydown=null,this.onkeyup=null,this.layout=new Guacamole.OnScreenKeyboard.Layout(o),this.getElement=function(){return s},this.resize=function(e){for(var t=Math.floor(10*e/f.layout.width)/10,n=0;n<g.length;n++)g[n].scale(t)},function(e,t){if(t instanceof Array){for(var n=[],o=0;o<t.length;o++)n.push(new Guacamole.OnScreenKeyboard.Key(t[o],e));return n}return"number"==typeof t?[new Guacamole.OnScreenKeyboard.Key({name:e,keysym:t})]:"string"==typeof t?[new Guacamole.OnScreenKeyboard.Key({name:e,title:t})]:[new Guacamole.OnScreenKeyboard.Key(t,e)]}),y=(this.keys=function(e){var t,n={};for(t in o.keys)n[t]=c(t,e[t]);return n}(o.keys),function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[^A-Za-z0-9]+/g,"-").toLowerCase()});(function c(d,t,e){var n=document.createElement("div");if(e&&v(n,"guac-keyboard-"+y(e)),t instanceof Array)for(v(n,"guac-keyboard-group"),o=0;o<t.length;o++)c(n,t[o]);else if(t instanceof Object){v(n,"guac-keyboard-group");for(var h=Object.keys(t).sort(),o=0;o<h.length;o++){e=h[o];c(n,t[e],e)}}else if("number"==typeof t)v(n,"guac-keyboard-gap"),g.push(new b(n,t,t));else if("string"==typeof t){var a=t,r=(1===a.length&&(a="0x"+a.charCodeAt(0).toString(16)),v(n,"guac-keyboard-key-container"),document.createElement("div")),i=(r.className="guac-keyboard-key guac-keyboard-key-"+y(a),f.keys[t]);if(i)for(o=0;o<i.length;o++){var s=i[o],u=document.createElement("div");u.className="guac-keyboard-cap",u.textContent=s.title;for(var l=0;l<s.requires.length;l++){var p=s.requires[l];v(u,"guac-keyboard-requires-"+y(p)),v(r,"guac-keyboard-uses-"+y(p))}r.appendChild(u)}n.appendChild(r),g.push(new b(n,f.layout.keyWidths[t]||1,1,!0));function m(e){e.preventDefault(),0===w&&k(t,r)}r.addEventListener("touchstart",function(e){e.preventDefault(),w=f.touchMouseThreshold,S(t,r)},!0),r.addEventListener("touchend",function(e){e.preventDefault(),w=f.touchMouseThreshold,k(t,r)},!0),r.addEventListener("mousedown",function(e){e.preventDefault(),0===w&&S(t,r)},!0),r.addEventListener("mouseup",m,!0),r.addEventListener("mouseout",m,!0)}d.appendChild(n)})(s,o.layout)},Guacamole.OnScreenKeyboard.Layout=function(e){this.language=e.language,this.type=e.type,this.keys=e.keys,this.layout=e.layout,this.width=e.width,this.keyWidths=e.keyWidths||{}},Guacamole.OnScreenKeyboard.Key=function(e,t){this.name=t||e.name,this.title=e.title||this.name,this.keysym=e.keysym||function(e){if(!e||1!==e.length)return null;e=e.charCodeAt(0);return 0<=e&&e<=255?e:256<=e&&e<=1114111?16777216|e:null}(this.title),this.modifier=e.modifier,this.requires=e.requires||[]},(Guacamole=Guacamole||{}).OutputStream=function(t,e){var n=this;this.index=e,this.onack=null,this.sendBlob=function(e){t.sendBlob(n.index,e)},this.sendEnd=function(){t.endStream(n.index)}},(Guacamole=Guacamole||{}).Parser=function(){var o=this,a="",r=[],i=-1,s=0;this.receive=function(e){for(4096<s&&s<=i&&(a=a.substring(s),i-=s,s=0),a+=e;i<a.length;){if(s<=i){var t=a.substring(s,i),n=a.substring(i,i+1);if(r.push(t),";"==n){t=r.shift();null!=o.oninstruction&&o.oninstruction(t,r),r.length=0}else if(","!=n)throw new Error("Illegal terminator.");s=i+1}t=a.indexOf(".",s);if(-1==t){s=a.length;break}n=parseInt(a.substring(i+1,t));if(isNaN(n))throw new Error("Non-numeric character in element length.");i=(s=t+1)+n}},this.oninstruction=null},(Guacamole=Guacamole||{}).Status=function(e,t){var n=this;this.code=e,this.message=t,this.isError=function(){return n.code<0||255<n.code}},Guacamole.Status.Code={SUCCESS:0,UNSUPPORTED:256,SERVER_ERROR:512,SERVER_BUSY:513,UPSTREAM_TIMEOUT:514,UPSTREAM_ERROR:515,RESOURCE_NOT_FOUND:516,RESOURCE_CONFLICT:517,CLIENT_BAD_REQUEST:768,CLIENT_UNAUTHORIZED:769,CLIENT_FORBIDDEN:771,CLIENT_TIMEOUT:776,CLIENT_OVERRUN:781,CLIENT_BAD_TYPE:783,CLIENT_TOO_MANY:797},(Guacamole=Guacamole||{}).StringReader=function(e){var t=this,e=new Guacamole.ArrayBufferReader(e),r=0,i=0;e.ondata=function(e){e=function(e){for(var t="",n=new Uint8Array(e),o=0;o<n.length;o++){var a=n[o];0===r?127==(127|a)?t+=String.fromCharCode(a):223==(31|a)?(i=31&a,r=1):239==(15|a)?(i=15&a,r=2):247==(7|a)?(i=7&a,r=3):t+="�":191==(63|a)?(i=i<<6|63&a,0===--r&&(t+=String.fromCharCode(i))):(r=0,t+="�")}return t}(e);t.ontext&&t.ontext(e)},e.onend=function(){t.onend&&t.onend()},this.ontext=null,this.onend=null},(Guacamole=Guacamole||{}).StringWriter=function(e){var t=this,n=new Guacamole.ArrayBufferWriter(e),s=new Uint8Array(8192),u=0;function l(e){var t,n,o,a;if(e<=127)t=0,n=1;else if(e<=2047)t=192,n=2;else if(e<=65535)t=224,n=3;else{if(!(e<=2097151))return void l(65533);t=240,n=4}u+(o=n)>=s.length&&((a=new Uint8Array(2*(u+o))).set(s),s=a);for(var r=(u+=o)-1,i=1;i<n;i++)s[r--]=128|63&e,e>>=6;s[r]=t|e}n.onack=function(e){t.onack&&t.onack(e)},this.sendText=function(e){n.sendData(function(e){for(var t,n=0;n<e.length;n++)l(e.charCodeAt(n));if(0<u)return t=s.subarray(0,u),u=0,t}(e))},this.sendEnd=function(){n.sendEnd()},this.onack=null},(Guacamole=Guacamole||{}).Tunnel=function(){this.connect=function(e){},this.disconnect=function(){},this.sendMessage=function(e){},this.state=Guacamole.Tunnel.State.CONNECTING,this.receiveTimeout=15e3,this.onerror=null,this.onstatechange=null,this.oninstruction=null},Guacamole.Tunnel.State={CONNECTING:0,OPEN:1,CLOSED:2},Guacamole.HTTPTunnel=function(e){var o,h=this,n=e+"?connect",t=e+"?read:",s=e+"?write:",p=1,a=!1,r="";function i(e){h.state!==Guacamole.Tunnel.State.CLOSED&&(e.code!==Guacamole.Status.Code.SUCCESS&&h.onerror&&(h.state!==Guacamole.Tunnel.State.CONNECTING&&e.code===Guacamole.Status.Code.RESOURCE_NOT_FOUND||h.onerror(e)),h.state=Guacamole.Tunnel.State.CLOSED,a=!1,h.onstatechange&&h.onstatechange(h.state))}function m(e){var t=parseInt(e.getResponseHeader("Guacamole-Status-Code")),e=e.getResponseHeader("Guacamole-Error-Message");i(new Guacamole.Status(t,e))}this.sendMessage=function(){if(h.state===Guacamole.Tunnel.State.OPEN&&0!==arguments.length){for(var e=n(arguments[0]),t=1;t<arguments.length;t++)e+=","+n(arguments[t]);r+=e+=";",a||function e(){if(h.state!==Guacamole.Tunnel.State.OPEN)return;{var t;0<r.length?(a=!0,(t=new XMLHttpRequest).open("POST",s+o),t.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),t.onreadystatechange=function(){4===t.readyState&&(200!==t.status?m(t):e())},t.send(r),r=""):a=!1}}()}function n(e){e=new String(e);return e.length+"."+e}};var u=0;function f(){var e=new XMLHttpRequest;return e.open("GET",t+o+":"+u++),e.send(null),e}this.connect=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(200===t.status?(o=t.responseText,h.state=Guacamole.Tunnel.State.OPEN,h.onstatechange&&h.onstatechange(h.state),function a(r){var i=null,s=null,e=0,u=-1,l=0,c=new Array;function d(){if(h.state===Guacamole.Tunnel.State.OPEN){if(!(r.readyState<2)){var t,e;try{t=r.status}catch(e){t=200}if(s||200!==t||(s=f()),3===r.readyState||4===r.readyState)if(1===p&&(3!==r.readyState||i?4!==r.readyState||i||clearInterval(i):i=setInterval(d,30)),0!==r.status)if(200===r.status){try{e=r.responseText}catch(e){return}for(;u<e.length;){l<=u&&(o=e.substring(l,u),n=e.substring(u,u+1),c.push(o),";"===n&&(o=c.shift(),h.oninstruction&&h.oninstruction(o,c),c.length=0),l=u+1);var n=e.indexOf(".",l);if(-1===n){l=e.length;break}var o=parseInt(e.substring(u+1,n));if(0===o){i||clearInterval(i),r.onreadystatechange=null,r.abort(),s&&a(s);break}u=(l=n+1)+o}}else m(r);else h.disconnect()}}else null!==i&&clearInterval(i)}r.onreadystatechange=1===p?function(){3===r.readyState&&2<=++e&&(p=0,r.onreadystatechange=d),d()}:d,d()}(f())):m(t))},t.open("POST",n,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),t.send(e)},this.disconnect=function(){i(new Guacamole.Status(Guacamole.Status.Code.SUCCESS,"Manually closed."))}},Guacamole.HTTPTunnel.prototype=new Guacamole.Tunnel,Guacamole.WebSocketTunnel=function(t){var e,n,s=this,a=null;function u(e){s.state!==Guacamole.Tunnel.State.CLOSED&&(e.code!==Guacamole.Status.Code.SUCCESS&&s.onerror&&s.onerror(e),s.state=Guacamole.Tunnel.State.CLOSED,s.onstatechange&&s.onstatechange(s.state),a.close())}"ws:"!==t.substring(0,3)&&"wss:"!==t.substring(0,4)&&(e={"http:":"ws:","https:":"wss:"}[window.location.protocol],t="/"===t.substring(0,1)?e+"//"+window.location.host+t:(n=window.location.pathname.lastIndexOf("/"),n=window.location.pathname.substring(0,n+1),e+"//"+window.location.host+n+t)),this.sendRawMessage=function(e){a.send(e)},this.sendMessage=function(e){if(s.state===Guacamole.Tunnel.State.OPEN&&0!==arguments.length){for(var t=o(e),n=1;n<arguments.length;n++)t+=","+o(arguments[n]);a.send(t+=";")}function o(e){e=new String(e);return e.length+"."+e}},this.connect=function(e){(a=new WebSocket(e?t+"?"+e:t,"guacamole")).onopen=function(e){s.state=Guacamole.Tunnel.State.OPEN,s.onstatechange&&s.onstatechange(s.state)},a.onclose=function(e){u(new Guacamole.Status(parseInt(e.reason),e.reason))},a.onerror=function(e){u(new Guacamole.Status(Guacamole.Status.Code.SERVER_ERROR,e.data))},a.onmessage=function(e){var t=e.data,n=0,o=[];do{var a,r=t.indexOf(".",n),r=(-1!==r?a=(n=r+1)+parseInt(t.substring(a+1,r)):u(new Guacamole.Status(Guacamole.Status.Code.SERVER_ERROR,"Incomplete instruction.")),t.substring(n,a)),i=t.substring(a,a+1)}while(o.push(r),";"===i&&(r=o.shift(),s.oninstruction&&s.oninstruction(r,o),o.length=0),(n=a+1)<t.length)}},this.disconnect=function(){u(new Guacamole.Status(Guacamole.Status.Code.SUCCESS,"Manually closed."))}},Guacamole.WebSocketTunnel.prototype=new Guacamole.Tunnel,Guacamole.ChainedTunnel=function(e){for(var r,i=this,s=[],t=0;t<arguments.length;t++)s.push(arguments[t]);this.connect=function(e){r=e;e=s.shift();e?function t(n){function o(){var e=s.shift();return e&&(n.onerror=null,n.oninstruction=null,n.onstatechange=null,t(e)),e}function a(){n.onstatechange=i.onstatechange,n.oninstruction=i.oninstruction,n.onerror=i.onerror}i.disconnect=n.disconnect,i.sendMessage=n.sendMessage,n.onstatechange=function(e){switch(e){case Guacamole.Tunnel.State.OPEN:a(),i.onstatechange&&i.onstatechange(e);break;case Guacamole.Tunnel.State.CLOSED:!o()&&i.onstatechange&&i.onstatechange(e)}},n.oninstruction=function(e,t){a(),i.oninstruction&&i.oninstruction(e,t)},n.onerror=function(e){!o()&&i.onerror&&i.onerror(e)},n.connect(r)}(e):i.onerror&&i.onerror(Guacamole.Status.Code.SERVER_ERROR,"No tunnels to try.")}},Guacamole.ChainedTunnel.prototype=new Guacamole.Tunnel;var DEBUG_LOG=!((Guacamole=Guacamole||{}).API_VERSION="0.9.5");function debugLog(e){DEBUG_LOG&&console.log(e)}var pingInterval,vmTableSelected,vmSettingsName,serverAddress="localhost:6004",DEBUG_SERVER_SETTINGS=!1,DEBUG_VM_SETTINGS=!1,DEBUG_LOGIN=!1,DEBUG_LOADING=!1,tunnel=new Guacamole.WebSocketTunnel(("https:"==location.protocol?"wss://":"ws://")+serverAddress+"/"),vmSettingsVisible=!1,vmList={},defaultVMSettings={name:"","vnc-address":"127.0.0.1","vnc-port":5900,"qmp-socket-type":"local","qmp-address":"","qmp-port":5800,"max-attempts":5,"qemu-cmd":"",hypervisor:"qemu","qemu-snapshot-mode":"off","restore-shutdown":!1,"restore-periodic":!1,"restore-hours":0,"restore-minutes":0,"turns-enabled":!1,"turn-time":20,"votes-enabled":!1,"vote-time":60,"vote-cooldown-time":120,"agent-enabled":!1,"agent-socket-type":"local","agent-use-virtio":!1,"agent-address":"","agent-port":5700,"restore-heartbeat":!1,"heartbeat-timeout":0,"uploads-enabled":!1,"upload-cooldown-time":120,"upload-max-size":20971520,"upload-max-filename":100},vmStatus={STOPPED:0,STARTING:1,RUNNING:2,STOPPING:3},statusMessages=["Stopped","Starting","Running","Stopping"],vmAction={Stop:"0",SeshID:"1",MasterPwd:"2",GetSettings:"3",SetSettings:"4",QEMU:"5",StartController:"6",StopController:"7",RestoreVM:"8",RebootVM:"9",ResetVM:"10",RestartVM:"11"};function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function forEachInput(e,t){e.find("input").filter(function(){return this.name&&!$(this).is(":disabled")&&(null!=this.value||this.checked)}).each(function(){var e=null,e=$(this).is(":checkbox")?this.checked:"number"===$(this).attr("type")?this.value:'"'+this.value+'"';t(this.name,e)}),e.find("button.dropdown-toggle").filter(function(){return this.name&&!$(this).is(":disabled")&&$(this).data("value")}).each(function(){t(this.name,'"'+$(this).data("value")+'"')})}function saveServerSettings(){displayLoading();var n="",o=0;forEachInput($("#server-settings"),function(e,t){"mod-perm-restore"===e?o+=t?1:0:"mod-perm-reboot"===e?o+=t?2:0:"mod-perm-ban"===e?o+=t?4:0:"mod-perm-forcevotes"===e?o+=t?8:0:"mod-perm-mute"===e?o+=t?16:0:"mod-perm-kick"===e?o+=t?32:0:"mod-perm-endturns"===e?o+=t?64:0:"mod-perm-renameuser"===e?o+=t?128:0:"mod-perm-copyip"===e?o+=t?256:0:n+='"'+e+'":'+t+","}),(n+='"mod-perms":'+o+",")&&(debugLog(n='{"settings":{'+n.substring(0,n.length-1)+"}}"),tunnel.sendMessage("admin",4,n))}function saveVMSettings(){displayLoading();var n="";forEachInput($("#vm-settings"),function(e,t){e.match("^vm-")&&(n+='"'+e.substr(3)+'":'+t+",")}),n&&(debugLog(n=vmSettingsName?'{"update-vm":{'+n.substring(0,n.length-1)+"}}":'{"add-vm":{'+n.substring(0,n.length-1)+"}}"),vmSettingsName=null,$("#vm-settings").hide(),$("#vm-list").parent().addClass("table-hover"),$("#new-vm-btn").prop("disabled",!1),tunnel.sendMessage("admin",4,n))}function splitQueryString(e){for(var t=e.split("&"),n={},o=0;o<t.length;o++){var a=t[o].split("="),r=decodeURIComponent(a[0]),a=a[1]||"";n[r]=decodeURIComponent(a.replace(/\+/g," "))}return n}function setInputValue(e,t,n){if("mod-perms"===t)return e.find("input[name='mod-perm-restore']").prop("checked",!!(1&n)),e.find("input[name='mod-perm-reboot']").prop("checked",!!(2&n)),e.find("input[name='mod-perm-ban']").prop("checked",!!(4&n)),e.find("input[name='mod-perm-forcevotes']").prop("checked",!!(8&n)),e.find("input[name='mod-perm-mute']").prop("checked",!!(16&n)),e.find("input[name='mod-perm-kick']").prop("checked",!!(32&n)),e.find("input[name='mod-perm-endturns']").prop("checked",!!(64&n)),e.find("input[name='mod-perm-renameuser']").prop("checked",!!(128&n)),e.find("input[name='mod-perm-copyip']").prop("checked",!!(256&n)),!0;var o=e.find("input[name='"+t+"']").eq(0);if(o.length)return o.is(":checkbox")?(o.prop("checked","1"==n),o.trigger("change")):("jpeg-quality"===t&&255==n&&o.parent().hide(),o.val(n)),!0;if((o=e.find("button.dropdown-toggle[name='"+t+"']").eq(0)).length){e=o.parent().find("ul.dropdown-menu li a[data-value='"+n+"']").eq(0);if(e.length)return o.html(e.text()+' <span class="caret"></span>'),o.data("value",n),o.trigger("dropdown"),!0}return!1}function displaySettingsError(e,t,n){n=n?createAlert("<strong>Successfully changed settings</strong>",!1,"success"):createAlert("<strong>Settings Error</strong><br>"+(t?"<em>"+e+"</em>: "+t:e));$("#alert-box").parent().parent().prepend(n),n.show("fast"),$("#new-vm-btn").prop("disabled",!1)}function parseSettings(e){var n,a,e=jQuery.parseJSON(e);e.result&&(!0!==e.result?(debugLog("Error changing settings"),debugLog(e.result),"object"==typeof e.result?$.each(e.result,displaySettingsError):displaySettingsError(e.result)):(debugLog("Successfully changed settings"),displaySettingsError(null,null,!0))),e.settings&&(n=$("#server-settings"),(a=$("#vm-list")).html(""),vmTableSelected=null,$.each(e.settings,function(e,t){"vm"==e&&$.isArray(t)?$.each(t,function(e,t){var n,o;t.hasOwnProperty("name")&&(vmList[t.name]=t,n=document.createElement("tr"),o=document.createElement("td"),(o=document.createElement("td")).innerHTML=t.name,n.appendChild(o),(o=document.createElement("td")).innerHTML=statusMessages[t.status],n.appendChild(o),$(n).click(function(){$("#vm-settings").is(":visible")||(vmTableSelected=$(this).addClass("info").find("td").eq(0).text(),updateVMButtons(vmList[vmTableSelected]))}),a.append(n))}):setInputValue(n,e,t)})),$("#server-settings").is(":visible")||displayServerSettings()}function updateVMButtons(e){var t=$("#vm-settings").is(":visible");$("#start-vm-btn").prop("disabled",t||!e||e.status!=vmStatus.STOPPED),$("#stop-vm-btn").prop("disabled",t||!e||e.status!=vmStatus.RUNNING),$("#restart-vm-btn").prop("disabled",t||!e||e.status!=vmStatus.RUNNING),$("#vm-action-btn").prop("disabled",t||!e||e.status!=vmStatus.RUNNING),$("#settings-vm-btn").prop("disabled",t||!e)}function getConfig(){displayLoading(),tunnel.sendMessage("admin",3)}function restoreVM(e){tunnel.sendMessage("admin",9,e)}function displayLoading(){$("#vm-settings").hide(),$("#server-settings").hide(),$("#password-input").hide(),$("#loading").show()}function displayPasswordInput(){$("#vm-settings").hide(),$("#server-settings").hide(),$("#loading").hide(),$("#invalid-pwd").hide(),$("#master-pwd").val("").prop("disabled",!1),$("#pwd-submit").prop("disabled",!1),$("#password-input").show("slow")}function displayServerSettings(){$("#password-input").hide(),vmSettingsName?($("#vm-settings").show(),updateVMButtons(vmList[vmSettingsName])):$("#vm-settings").hide(),$("#loading").hide(),$("#server-settings").show("slow")}function showVMSettings(e){var t,n;if(e){if(!(t=vmList[e]))return;n="<em>"+t.name+"</em> Settings",$("#delete-vm-btn").show(),$("#qemu-monitor").show()}else t=defaultVMSettings,n="New VM Settings",$("#delete-vm-btn").hide(),$("#qemu-monitor").hide();$("#vm-panel-heading").html(n);var o=$("#vm-settings");$.each(t,function(e,t){setInputValue(o,"vm-"+e,t)}),$("#restore-hours-box").val(0),$("#restore-minutes-box").val(0),vmSettingsName=e,$("#new-vm-btn").prop("disabled",!0),hideVMSettings(!0)}function hideVMSettings(e){e=!!e,$("#new-vm-btn").prop("disabled",!1),e?($("#vm-list").parent().removeClass("table-hover"),$("#vm-settings").show("slow")):($("#vm-list").parent().addClass("table-hover"),$("#vm-settings").hide("fast"),vmSettingsName=null),vmSettingsVisible=e}function createAlert(e,t,n){return $('<div class="alert alert-'+(n||"danger")+' alert-dismissible" role="alert"'+(t?"":' style="display: none;"')+'><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+e+"</div>")}function submitPassword(){$("#invalid-pwd").hide();var e=$("#master-pwd");e.prop("disabled",!0),$("#pwd-submit").prop("disabled",!0),tunnel.sendMessage("admin",2,e.val())}function changePassword(){tunnel.sendMessage("admin",4,'{"password":"'+$("#chng-pwd-box").val()+'"}')}function changeModPassword(){tunnel.sendMessage("admin",4,'{"mod-pw":"'+$("#chng-modpwd-box").val()+'"}')}function connect(){if(tunnel.state==Guacamole.Tunnel.State.CONNECTING||tunnel.state==Guacamole.Tunnel.State.CLOSED)try{displayLoading(),tunnel.connect()}catch(e){reconnect()}else tunnel.disconnect()}function reconnect(){setTimeout(function(){tunnel.state=Guacamole.Tunnel.State.CONNECTING,connect()},5e3)}function sendQEMUCmd(){var e,t;tunnel.state==Guacamole.Tunnel.State.OPEN&&null!=vmSettingsName&&(t=(e=$("#qemu-monitor-input")).val().trim(),tunnel.sendMessage("admin",5,vmSettingsName,t),qemuMonitorOutput("&#13;&#10;> "+t),e.val(""))}function qemuMonitorOutput(e){var t=$("#qemu-monitor-output");t.html(t.html()+e+"&#13;&#10;"),t.scrollTop(t[0].scrollHeight)}tunnel.onstatechange=function(e){switch(e){case Guacamole.Tunnel.State.OPEN:debugLog("Connected to server");var t=getCookie("sessionID");t?tunnel.sendMessage("admin",1,t):displayPasswordInput();break;case Guacamole.Tunnel.State.CLOSED:debugLog("Disconnected from server"),displayLoading(),pingInterval&&(window.clearInterval(pingInterval),pingInterval=null),reconnect()}},tunnel.oninstruction=function(e,t){if("admin"==e){if(1<t.length){var n,o,a,r=parseInt(t[0]);if(!isNaN(r))switch(r){case 0:0==t[1]?($("#password-input").is(":visible")||displayPasswordInput(),n=createAlert("<strong>Invalid Password</strong>"),$("#password-input").prepend(n),n.show("fast"),(o=$("#master-pwd")).val(""),o.prop("disabled",!1),$("#pwd-submit").prop("disabled",!1)):1==t[1]?(vmTableSelected=vmSettingsName=null,$("#vm-list").html(""),getConfig()):2==t[1]?displaySettingsError("Invalid VM ID"):3==t[1]&&($("#password-input").is(":visible")||displayPasswordInput(),n=createAlert("<strong>Please log in on the VM View.</strong>"),$("#password-input").prepend(n),n.show("fast"),(o=$("#master-pwd")).val(""),o.prop("disabled",!1),$("#pwd-submit").prop("disabled",!1));break;case 1:parseSettings(t[1]),$("#server-settings").is(":visible")||displayServerSettings();break;case 2:qemuMonitorOutput("&#13;&#10;"+t[1]);break;case 3:vmList.hasOwnProperty(t[1])&&((a=vmList[t[1]]).status=t[2],a.active=a.status!=vmStatus.STOPPED,$("#vm-list > tr").each(function(){var e=$(this).children("td");if(e.eq(0).html()==a.name)return e.eq(1).html(statusMessages[a.status]),!1}),vmTableSelected===a.name&&updateVMButtons(a))}}}else"nop"==e&&tunnel.sendMessage("nop")},$(function(){$("div.btn-group").not("[data-no-dropdown]").find("ul.dropdown-menu li a").click(function(e){e.preventDefault();var t,n,e=$(this).parent();e.hasClass("disabled")||((t=(e=e.parent().parent()).find("button")).html($(this).text()+' <span class="caret"></span>'),n=$(this).data("value"),t.data("value",n),e.removeClass("open"),t.trigger("dropdown",n))}),$("#start-vm-btn").click(function(){tunnel.sendMessage("admin",vmAction.StartController,vmTableSelected)}),$("#stop-vm-btn").click(function(){tunnel.sendMessage("admin",vmAction.StopController,vmTableSelected)}),$("#restart-vm-btn").click(function(){tunnel.sendMessage("admin",vmAction.RestartVM,vmTableSelected)}),$("#vm-action-dropdown ul.dropdown-menu li a").click(function(e){e.preventDefault(),tunnel.sendMessage("admin",vmAction[$(this).data("value")],vmTableSelected)}),$("#settings-vm-btn").click(function(){$("#vm-settings").is(":visible")?alert("Please close the current VM settings before editing this VM's settings."):showVMSettings(vmTableSelected)}),$("#new-vm-btn").click(function(){vmSettingsName||$("#vm-settings").is(":visible")?alert("Please close the current VM settings before adding a new VM."):showVMSettings(null)}),$("#vm-qemu-snapshot-mode").on("dropdown",function(){var e="hd"==$(this).data("value");$("#restore-shutdown-chkbox").prop("disabled",!e),$("#restore-periodic-chkbox").prop("disabled",!e),$("#restore-periodic-chkbox").trigger("change")}),$("#qemu-monitor-send").click(function(){sendQEMUCmd()}),$("#qemu-monitor-input").keypress(function(e){13===e.which&&sendQEMUCmd()}),$("#chng-pwd-chkbox").change(function(){var e=!$(this).prop("checked");$("#chng-pwd-box").prop("disabled",e),$("#chng-pwd-btn").prop("disabled",e)}),$("#chng-modpwd-chkbox").change(function(){var e=!$(this).prop("checked");$("#chng-modpwd-box").prop("disabled",e),$("#chng-modpwd-btn").prop("disabled",e)}),$("#chng-pwd-btn").click(function(){changePassword()}),$("#chng-modpwd-btn").click(function(){changeModPassword()}),$("#mod-enabled-chkbox").change(function(){$("#mod-perms input").prop("disabled",!$(this).prop("checked"))}),$("#turns-enabled-chkbox").change(function(){$("#turn-time-box").prop("disabled",!$(this).prop("checked"))}),$("#votes-enabled-chkbox").change(function(){$("#vote-time-box, #vote-cooldown-time-box").prop("disabled",!$(this).prop("checked"))}),$("#agent-enabled-chkbox").change(function(){$("#agent-socket-type-dropdown, #agent-use-virtio-chkbox, #agent-address-box, #restore-heartbeat-chkbox, #uploads-enabled-chkbox").prop("disabled",!$(this).prop("checked")).trigger("disabled")}),$("#agent-socket-type-dropdown").on("dropdown",function(e,t){$("#agent-port").prop("disabled","tcp"!==t)}).on("disabled",function(){$("#agent-port").prop("disabled",$(this).prop("disabled")||"tcp"!==$(this).data("value"))}),$("#uploads-enabled-chkbox").change(function(){$("#upload-cooldown-time-box, #upload-max-size-box, #upload-max-filename-box").prop("disabled",!$(this).prop("checked"))}).on("disabled",function(){$("#upload-cooldown-time-box, #upload-max-size-box, #upload-max-filename-box").prop("disabled",$(this).prop("disabled")||!$(this).prop("checked"))}),$("#restore-periodic-chkbox").change(function(){var e=!$(this).prop("checked");$("#restore-hours-box").prop("disabled",e),$("#restore-minutes-box").prop("disabled",e)}),$("#vm-name").keydown(function(e){32===e.which&&e.preventDefault()}),$("#delete-vm-btn").click(function(){vmSettingsName&&window.confirm("Are you sure you want to delete this VM?")&&(tunnel.sendMessage("admin",4,'{"del-vm":"'+vmSettingsName+'"}'),hideVMSettings())}),$("#save-server-settings").click(function(){saveServerSettings()}),$("#save-vm-btn").click(function(){saveVMSettings()}),$("#pwd-submit").click(function(){submitPassword()}),$("#master-pwd").keypress(function(e){13===e.which&&submitPassword()}),$("#vm-x-btn").click(function(){window.confirm("Warning\nIf you changed any settings they will not be saved.\n\nContinue?")&&hideVMSettings()});var e='{"settings":{"chat-rate-count":4,"chat-rate-time":3,"chat-mute-time":30,"max-cons":5,"max-upload-time":120,"vm":[{"id":0,"auto-start":true,"status":3,"display-name":"Windows XP","name":"win-xp","vnc-address":"127.0.0.1","vnc-port":5900,"qmp-address":"","qmp-port":5800,"qemu-cmd":"qemu-system-x86_64 -hda /home/user/Documents/win-xp-vm/win-xp.img -usbdevice tablet","restore-shutdown":true,"turns-enabled":true,"turn-time":20,"votes-enabled":true,"vote-time":60,"vote-cooldown-time":0,"qmp-socket-type":"local","hypervisor":"qemu","qemu-snapshot-mode":"hd","agent-enabled":false,"agent-socket-type":"local","agent-use-virtio":false,"agent-address":"","agent-port":5700,"uploads-enabled":false,"upload-cooldown-time":120,"upload-max-size":20971520,"upload-max-filename":100}]}}';DEBUG_SERVER_SETTINGS?(parseSettings(e),displayServerSettings()):DEBUG_VM_SETTINGS?(parseSettings(e),displayServerSettings(),showVMSettings("win-xp")):(DEBUG_LOGIN?displayPasswordInput:DEBUG_LOADING?displayLoading:connect)()});